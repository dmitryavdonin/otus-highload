<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ10. –û—Ç—á–µ—Ç –ø–æ —Å–µ—Ä–≤–∏—Å—É —Å—á–µ—Ç—á–∏–∫–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h1 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            margin-top: 30px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        pre {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
        }
        code {
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            background-color: #f8f8f8;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .highlight {
            background-color: #ffffcc;
            padding: 2px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .note {
            background-color: #e7f3fe;
            border-left: 6px solid #2196F3;
            padding: 10px;
            margin: 15px 0;
        }
        .warning {
            background-color: #fff3cd;
            border-left: 6px solid #ffc107;
            padding: 10px;
            margin: 15px 0;
        }
        .success {
            background-color: #d4edda;
            border-left: 6px solid #28a745;
            padding: 10px;
            margin: 15px 0;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        .architecture-diagram {
            text-align: center;
            margin: 20px 0;
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        .comparison-table {
            margin: 20px 0;
        }
        .improvement {
            font-weight: bold;
        }
        .improvement.positive {
            color: #28a745;
        }
        .improvement.negative {
            color: #dc3545;
        }
        .step {
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
        }
        .test-scenario {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .api-endpoint {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 4px;
            padding: 8px;
            margin: 5px 0;
            font-family: monospace;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                fontFamily: 'Arial, sans-serif',
                fontSize: '14px'
            }
        });
    </script>
</head>
<body>
    <h1>OTUS. Highload Architecture</h1>
    <h2>–î–ó ‚Ññ 10 - –°–µ—Ä–≤–∏—Å —Å—á–µ—Ç—á–∏–∫–æ–≤</h2>
    <h3>–ê–≤–¥–æ–Ω–∏–Ω –î–º–∏—Ç—Ä–∏–π</h3>

    <h2>–ó–∞–¥–∞—á–∞</h2>
    <p>–°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å —Å—á–µ—Ç—á–∏–∫–æ–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞–º–∏ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:</p>
    <ul>
        <li>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–µ—Ä–≤–∏—Å —Å—á–µ—Ç—á–∏–∫–æ–≤ —Å —É—á–µ—Ç–æ–º –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —á—Ç–µ–Ω–∏–µ</li>
        <li>–û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —Å—á–µ—Ç—á–∏–∫–æ–º –∏ —Ä–µ–∞–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</li>
        <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω SAGA –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏</li>
        <li>–í–Ω–µ–¥—Ä–∏—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤</li>
    </ul>

    <h2>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è</h2>
    
    <h3>SAGA Pattern –∏ Event-Driven Architecture</h3>
    <div class="architecture-diagram">
        <div class="mermaid">
graph TB
    subgraph "Dialog Service"
        DS[Dialog Service<br/>Port 8002]
        DSO[Outbox Table<br/>PostgreSQL]
        DSP[Event Publisher<br/>Background Worker]
    end

    subgraph "Message Broker"
        RMQ[RabbitMQ<br/>Port 5672<br/>Exchange counter_events]
        MUI[Management UI<br/>Port 15672]
    end

    subgraph "Counter Service"
        CS[Counter Service<br/>Port 8003]
        CSC[Event Consumer<br/>Background Worker]
        RCS[Redis Storage<br/>DB 2]
        REC[Reconciliation<br/>Background Process]
    end

    subgraph "Data Storage"
        PG[PostgreSQL<br/>Port 5432<br/>Dialogs and Outbox]
        RD1[Redis DB 1<br/>Dialogs Storage]
        RD2[Redis DB 2<br/>Counters Storage]
    end

    subgraph "Load Balancer"
        NGX[Nginx<br/>Port 8080]
    end

    subgraph "Main API"
        API[API Service<br/>Port 8000]
    end

    API -->|Send Message| DS
    DS -->|Save Message| RD1
    DS -->|Add Event| DSO
    DSP -->|Publish Event| RMQ
    RMQ -->|Consume Event| CSC
    CSC -->|Update Counters| RD2

    API -->|Read Counters| CS
    CS -->|Get Counters| RD2

    REC -->|Check Consistency| RD1
    REC -->|Update if Needed| RD2

    NGX --> API
    NGX --> DS
    NGX --> CS

    DS --> PG
    DS --> RD1
    CS --> RD2
    REC --> RD1

    classDef dialog fill:#e1f5fe
    classDef counter fill:#f3e5f5
    classDef storage fill:#fff8e1
    classDef broker fill:#e8f5e8
    classDef api fill:#fff3e0

    class DS,DSO,DSP dialog
    class CS,CSC,RCS,REC counter
    class PG,RD1,RD2 storage
    class RMQ,MUI broker
    class API,NGX api
        </div>
    </div>

    <h3>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã</h3>
    <table>
        <tr>
            <th>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th>
            <th>–ü–æ—Ä—Ç</th>
            <th>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</th>
            <th>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</th>
        </tr>
        <tr>
            <td>Main API Service</td>
            <td>8000</td>
            <td>–û—Å–Ω–æ–≤–Ω–æ–µ REST API</td>
            <td>FastAPI, PostgreSQL</td>
        </tr>
        <tr>
            <td>Dialog Service</td>
            <td>8002</td>
            <td>–°–µ—Ä–≤–∏—Å —Å–æ–æ–±—â–µ–Ω–∏–π</td>
            <td>FastAPI, Redis, PostgreSQL, RabbitMQ</td>
        </tr>
        <tr>
            <td>Counter Service</td>
            <td>8003</td>
            <td>–°–µ—Ä–≤–∏—Å —Å—á–µ—Ç—á–∏–∫–æ–≤</td>
            <td>FastAPI, Redis, RabbitMQ</td>
        </tr>
        <tr>
            <td>PostgreSQL</td>
            <td>5432</td>
            <td>–û—Å–Ω–æ–≤–Ω–∞—è –ë–î</td>
            <td>PostgreSQL 15</td>
        </tr>
        <tr>
            <td>Redis</td>
            <td>6379</td>
            <td>–ö—ç—à –∏ —Å—á–µ—Ç—á–∏–∫–∏</td>
            <td>Redis 7</td>
        </tr>
        <tr>
            <td>RabbitMQ</td>
            <td>5672, 15672</td>
            <td>Message Broker</td>
            <td>RabbitMQ 3.13</td>
        </tr>
        <tr>
            <td>Nginx</td>
            <td>8080</td>
            <td>Load Balancer</td>
            <td>Nginx Alpine</td>
        </tr>
    </table>

    <h2>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è SAGA Pattern</h2>

    <h3>1. Outbox Pattern</h3>
    <div class="note">
        <strong>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π:</strong>
        <ul>
            <li>–°–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ <code>outbox_events</code> —Ç–∞–±–ª–∏—Ü—É –≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</li>
            <li>–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏</li>
            <li>Event Publisher —á–∏—Ç–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ RabbitMQ</li>
            <li>–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏—è –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ processed</li>
        </ul>
    </div>

    <pre><code>async def add_outbox_event(event_type: str, payload: Dict[str, Any]) -> str:
    event_id = str(uuid.uuid4())
    async with get_session() as session:
        session.add(OutboxEvent(
            id=event_id,
            event_type=event_type,
            payload=payload,
            created_at=datetime.utcnow(),
            processed=False
        ))
        await session.commit()
    return event_id</code></pre>

    <h3>2. Event Types</h3>
    <table>
        <tr>
            <th>Event Type</th>
            <th>Trigger</th>
            <th>Payload</th>
            <th>Counter Action</th>
        </tr>
        <tr>
            <td><code>MessageSent</code></td>
            <td>–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</td>
            <td><code>from_user_id</code>, <code>to_user_id</code>, <code>message_id</code></td>
            <td>Increment: +1 to recipient</td>
        </tr>
        <tr>
            <td><code>MessagesRead</code></td>
            <td>–ü—Ä–æ—á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π</td>
            <td><code>user_id</code>, <code>peer_id</code>, <code>delta</code>, <code>last_read_ts</code></td>
            <td>Decrement: -delta from user</td>
        </tr>
    </table>

    <h3>3. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</h3>
    <div class="success">
        <strong>–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:</strong>
        <ul>
            <li>–ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π <code>event_id</code></li>
            <li>Counter Service –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Redis SETNX –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏</li>
            <li>TTL –Ω–∞ –∫–ª—é—á–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: 24 —á–∞—Å–∞</li>
            <li>–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è</li>
        </ul>
    </div>

    <h2>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞</h2>    
    
    <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:</h3>
    <ul>
        <li><strong>services/counter/app/main.py</strong> - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ Counter Service</li>
        <li><strong>services/counter/app/rabbitmq_consumer.py</strong> - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π RabbitMQ</li>
        <li><strong>services/dialog/app/outbox.py</strong> - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Outbox Pattern</li>
        <li><strong>services/dialog/app/publisher.py</strong> - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π</li>
        <li><strong>services/dialog/app/rabbitmq_publisher.py</strong> - RabbitMQ publisher</li>
        <li><strong>deploy/docker/docker-compose.yml</strong> - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤</li>
    </ul>

    <h3>–°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:</h3>
    <div class="note">
        –†–∞–∑–º–µ—â–µ–Ω—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ <code>lessons/lesson-10/</code>
    </div>
    <ul>
        <li><strong>start_service.sh</strong> - –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã</li>
        <li><strong>stop_service.sh</strong> - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã</li>
        <li><strong>check_status.sh</strong> - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤</li>
        <li><strong>test.sh</strong> - –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤</li>
    </ul>

    <h2>API Endpoints</h2>

    <h3>Counter Service API</h3>
    <div class="api-endpoint">
        <strong>GET</strong> /api/v1/counters/{user_id}
    </div>
    <p>–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—â–∏–π + –ø–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞–º)</p>

    <div class="api-endpoint">
        <strong>GET</strong> /api/v1/counters/{user_id}/peer/{peer_id}
    </div>
    <p>–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞</p>

    <div class="api-endpoint">
        <strong>POST</strong> /api/v1/counters/mark_read
    </div>
    <p>–ü–æ–º–µ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö (—É–º–µ–Ω—å—à–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞)</p>

    <pre><code>{
    "user_id": "user-uuid",
    "peer_user_id": "peer-uuid", 
    "delta": 3,
    "last_read_ts": 1699123456.789,
    "idempotency_key": "optional-key"
}</code></pre>

    <h3>Internal Events API</h3>
    <div class="api-endpoint">
        <strong>POST</strong> /internal/events/message_sent
    </div>
    <p>–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è</p>

    <div class="api-endpoint">
        <strong>POST</strong> /internal/events/messages_read
    </div>
    <p>–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π</p>

    <h2>–°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Redis</h2>

    <h3>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª—é—á–µ–π</h3>
    <table>
        <tr>
            <th>–ö–ª—é—á</th>
            <th>–¢–∏–ø</th>
            <th>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</th>
            <th>–ü—Ä–∏–º–µ—Ä</th>
        </tr>
        <tr>
            <td><code>user:{user_id}:unread_total</code></td>
            <td>String</td>
            <td>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö</td>
            <td><code>user:123:unread_total ‚Üí "5"</code></td>
        </tr>
        <tr>
            <td><code>user:{user_id}:unread_by_peer</code></td>
            <td>Hash</td>
            <td>–°—á–µ—Ç—á–∏–∫–∏ –ø–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞–º</td>
            <td><code>user:123:unread_by_peer ‚Üí {peer1: "3", peer2: "2"}</code></td>
        </tr>
        <tr>
            <td><code>user:{user_id}:last_read:{peer_id}</code></td>
            <td>String</td>
            <td>Timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—á—Ç–µ–Ω–∏—è</td>
            <td><code>user:123:last_read:peer1 ‚Üí "1699123456.789"</code></td>
        </tr>
        <tr>
            <td><code>event_dedup:{event_id}</code></td>
            <td>String</td>
            <td>–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π (TTL 24h)</td>
            <td><code>event_dedup:uuid ‚Üí "1"</code></td>
        </tr>
    </table>

    <h3>–û–ø–µ—Ä–∞—Ü–∏–∏ —Å Redis</h3>
    <div class="note">
        <strong>–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Pipeline:</strong>
        <ul>
            <li><strong>Message Sent:</strong> INCR total + HINCRBY by_peer</li>
            <li><strong>Messages Read:</strong> SET total + HSET by_peer (—Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π)</li>
            <li><strong>Deduplication:</strong> SETNX + EXPIRE</li>
        </ul>
    </div>

    <h2>Reconciliation –º–µ—Ö–∞–Ω–∏–∑–º</h2>

    <h3>–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–≤–µ—Ä–∫–∞</h3>
    <div class="warning">
        <strong>–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ eventual consistency:</strong>
        <ul>
            <li>–ö–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ RECONCILIATION_INTERVAL_SEC)</li>
            <li>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ Redis DB1 (–¥–∏–∞–ª–æ–≥–∏)</li>
            <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π</li>
            <li>–£—á–µ—Ç last_read_ts –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞</li>
        </ul>
    </div>

    <pre><code>async def reconcile_all(self):
    # –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Å—á–µ—Ç—á–∏–∫–∞–º–∏
    pattern = "user:*:unread_by_peer"
    for user_id, by_peer_key in users_pairs:
        by_peer = await self.redis_counters.hgetall(by_peer_key)
        corrected_by_peer = {}
        
        for peer_id, current_count in by_peer.items():
            # –ü–æ–ª—É—á–∞–µ–º last_read timestamp
            last_read = await self.redis_counters.get(
                self._key_last_read(user_id, peer_id)
            )
            last_ts = float(last_read) if last_read else 0.0
            
            # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
            dialog_key = self._dialog_key(user_id, peer_id)
            raw_msgs = await self.redis_dialogs.zrangebyscore(
                dialog_key, min=last_ts, max="+inf"
            )
            
            # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            actual_count = sum(1 for m in raw_msgs 
                             if json.loads(m).get("to_user_id") == user_id)
            corrected_by_peer[peer_id] = actual_count
        
        # –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        total_val = sum(corrected_by_peer.values())
        pipe = self.redis_counters.pipeline()
        pipe.hset(by_peer_key, mapping=corrected_by_peer)
        pipe.set(self._key_total(user_id), total_val)
        await pipe.execute()</code></pre>

    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
    <div class="test-scenario">
        <h4>–¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π</h4>
        <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ flow –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –ø—Ä–æ—á—Ç–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        <ul>
            <li>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è 2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
            <li>–û—Ç–ø—Ä–∞–≤–∫–∞ 1 —Å–æ–æ–±—â–µ–Ω–∏—è User1 ‚Üí User2</li>
            <li>–ü—Ä–æ–≤–µ—Ä–∫–∞: <code>total_unread = 1, by_peer[User1] = 1</code></li>
            <li>–ü–æ–º–µ—Ç–∫–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ (delta=1)</li>
            <li>–ü—Ä–æ–≤–µ—Ä–∫–∞: <code>total_unread = 0, by_peer[User1] = 0</code></li>
        </ul>
        <div class="success">‚úÖ –ü–†–û–ô–î–ï–ù: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</div>
    </div>

    <div class="test-scenario">
        <h4>–¢–µ—Å—Ç 2: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h4>
        <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
        <ul>
            <li>–û—Ç–ø—Ä–∞–≤–∫–∞ 10 —Å–æ–æ–±—â–µ–Ω–∏–π Multi1 ‚Üí Multi2</li>
            <li>–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è: <code>total_unread = 10</code></li>
            <li>–ß–∞—Å—Ç–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ #1: 3 —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –æ—Å—Ç–∞–µ—Ç—Å—è 7</li>
            <li>–ß–∞—Å—Ç–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ #2: 4 —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –æ—Å—Ç–∞–µ—Ç—Å—è 3</li>
            <li>–ü–æ–ª–Ω–æ–µ —á—Ç–µ–Ω–∏–µ: 3 —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –æ—Å—Ç–∞–µ—Ç—Å—è 0</li>
        </ul>
        <div class="success">‚úÖ –ü–†–û–ô–î–ï–ù: Delta –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —á–∞—Å—Ç–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—é—Ç</div>
    </div>

    <div class="test-scenario">
        <h4>–¢–µ—Å—Ç 3: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–∏</h4>
        <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—á–µ—Ç—á–∏–∫–æ–≤ –ø–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞–º
        <ul>
            <li>Sender1 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 5 —Å–æ–æ–±—â–µ–Ω–∏–π ‚Üí Receiver</li>
            <li>Sender2 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 3 —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí Receiver</li>
            <li>–ü—Ä–æ–≤–µ—Ä–∫–∞: <code>total = 8, by_peer[Sender1] = 5, by_peer[Sender2] = 3</code></li>
            <li>–°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ 2 —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç Sender1</li>
            <li>–ü—Ä–æ–≤–µ—Ä–∫–∞: <code>total = 6, by_peer[Sender1] = 3, by_peer[Sender2] = 3</code></li>
        </ul>
        <div class="success">‚úÖ –ü–†–û–ô–î–ï–ù: By-peer —Å—á–µ—Ç—á–∏–∫–∏ –∏ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—é—Ç</div>
    </div>

    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤</h3>
    <pre><code>=== Test Summary ===
Passed: 3/3
ALL TESTS PASSED! üéâ

‚úÖ Basic scenario passed
‚úÖ Multi-message scenario passed - demonstrated partial reads!
‚úÖ Multiple senders scenario passed - demonstrated by_peer counters!</code></pre>

    <h2>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å</h2>

    <h3>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫</h3>
    <table>
        <tr>
            <th>–ê—Å–ø–µ–∫—Ç</th>
            <th>–†–µ—à–µ–Ω–∏–µ</th>
            <th>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ</th>
        </tr>
        <tr>
            <td>–•—Ä–∞–Ω–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤</td>
            <td>Redis (–≤ –ø–∞–º—è—Ç–∏)</td>
            <td>O(1) –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è</td>
        </tr>
        <tr>
            <td>–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å</td>
            <td>Redis Pipeline</td>
            <td>Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞ –æ–¥–∏–Ω RTT</td>
        </tr>
        <tr>
            <td>–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</td>
            <td>–û—Ç–¥–µ–ª—å–Ω—ã–µ Redis DB</td>
            <td>–ò–∑–æ–ª—è—Ü–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –∏ —Å—á–µ—Ç—á–∏–∫–æ–≤</td>
        </tr>
        <tr>
            <td>–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å</td>
            <td>FastAPI + asyncio</td>
            <td>–í—ã—Å–æ–∫–∞—è concurrency</td>
        </tr>
        <tr>
            <td>Event processing</td>
            <td>RabbitMQ</td>
            <td>Reliable delivery + scaling</td>
        </tr>
        <tr>
            <td>–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</td>
            <td>Redis SETNX + TTL</td>
            <td>–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è</td>
        </tr>
    </table>

    <h3>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å</h3>
    <ul>
        <li><strong>Health checks:</strong> /health endpoint –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤</li>
        <li><strong>RabbitMQ Management:</strong> http://localhost:15672 (admin/admin123)</li>
        <li><strong>Docker metrics:</strong> —á–µ—Ä–µ–∑ docker stats</li>
        <li><strong>Service status:</strong> ./check_status.sh</li>
    </ul>

    <h2>–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>

    <h3>1. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã</h3>
    <pre><code>cd lessons/lesson-10
./start_service.sh</code></pre>
    <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:</p>
    <ul>
        <li>–°–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑—ã</li>
        <li>–ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã</li>
        <li>–ñ–¥–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ health checks</li>
        <li>–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API</li>
    </ul>

    <h3>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞</h3>
    <pre><code>./check_status.sh</code></pre>
    <p>–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:</p>
    <ul>
        <li>–°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤</li>
        <li>Health check –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤</li>
        <li>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ RabbitMQ</li>
        <li>Docker Compose —Å—Ç–∞—Ç—É—Å</li>
    </ul>

    <h3>3. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤</h3>
    <pre><code>./test.sh</code></pre>
    <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:</p>
    <ul>
        <li>–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤</li>
        <li>–ó–∞–ø—É—Å–∫–∞–µ—Ç test_counters.py</li>
    </ul>

    <h3>4. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h3>
    <pre><code>./stop_service.sh</code></pre>

    <h2>–õ–æ–≥–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã</h2>

    <h3>–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
    <table>
        <tr>
            <th>–°–µ—Ä–≤–∏—Å</th>
            <th>–ö–æ–º–∞–Ω–¥–∞</th>
            <th>–ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è</th>
        </tr>
        <tr>
            <td>Counter Service</td>
            <td><code>docker logs docker-counter-service-1</code></td>
            <td>Event processing, Redis operations, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</td>
        </tr>
        <tr>
            <td>Dialog Service</td>
            <td><code>docker logs docker-dialog-service-1</code></td>
            <td>Message operations, Outbox events, RabbitMQ publishing</td>
        </tr>
        <tr>
            <td>RabbitMQ</td>
            <td><code>docker logs docker-rabbitmq-1</code></td>
            <td>Queue operations, connections, message routing</td>
        </tr>
        <tr>
            <td>Main API</td>
            <td><code>docker logs docker-monolith-1</code></td>
            <td>HTTP requests, authentication, business logic</td>
        </tr>
    </table>

    <h3>–ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã</h3>

    <h4>Counter Service - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π</h4>
    <pre><code>INFO:     172.19.0.7:50358 - "POST /internal/events/message_sent HTTP/1.1" 200 OK
INFO:     Started RabbitMQ consumer successfully
INFO:     Event processed: MessageSent ‚Üí user:uuid ‚Üí increment counters</code></pre>

    <h4>Dialog Service - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π</h4>
    <pre><code>INFO:     Publishing event: counter.MessageSent
INFO:     Event added to outbox: MessageSent
INFO:     Message saved successfully: msg_id=uuid</code></pre>

    <h4>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - —É—Å–ø–µ—à–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏</h4>
    <pre><code>Registering users...
Registration successful: user_id=6e5368c9-bdb2-4c07-9bbf-6d1f2d2d76f3
Send message U1 -> U2...
MessageId=3b95007b-7e6b-46ad-b24d-790c2f0930a7
Waiting for counter increment...
Counters: total=1 by_peer[6e5368c9-bdb2-4c07-9bbf-6d1f2d2d76f3]=1
SUCCESS: Basic scenario passed</code></pre>

    <h2>–í—ã–≤–æ–¥—ã</h2>

    <div class="success">
        <h3>‚úÖ –£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:</h3>
        <ul>
            <li><strong>Counter Service</strong> —Å REST API –∏ –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é —á—Ç–µ–Ω–∏—è</li>
            <li><strong>SAGA Pattern</strong> —Å Outbox Pattern –∏ RabbitMQ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π</li>
            <li><strong>Event-Driven Architecture</strong> —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Å–æ–±—ã—Ç–∏–π</li>
            <li><strong>–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</strong> —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π</li>
            <li><strong>Reconciliation</strong> –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è eventual consistency</li>
            <li><strong>By-peer —Å—á–µ—Ç—á–∏–∫–∏</strong> —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è</li>
            <li><strong>Redis –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</strong> –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ –Ω–∞ —á—Ç–µ–Ω–∏–µ</li>
            <li><strong>Comprehensive testing</strong> —Å 3 E2E —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏</li>
        </ul>
    </div>

    <h3>–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∑–∞–¥–∞–Ω–∏—è</h3>
    
    <table>
        <tr>
            <th>–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
        </tr>
        <tr>
            <td>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–µ—Ä–≤–∏—Å —Å—á–µ—Ç—á–∏–∫–æ–≤</td>
            <td><span class="improvement positive">‚úÖ –í–´–ü–û–õ–ù–ï–ù–û</span></td>
            <td>FastAPI —Å–µ—Ä–≤–∏—Å –Ω–∞ –ø–æ—Ä—Ç—É 8003</td>
        </tr>
        <tr>
            <td>–£—á–µ—Å—Ç—å –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —á—Ç–µ–Ω–∏–µ</td>
            <td><span class="improvement positive">‚úÖ –í–´–ü–û–õ–ù–ï–ù–û</span></td>
            <td>Redis —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, O(1) –æ–ø–µ—Ä–∞—Ü–∏–∏</td>
        </tr>
        <tr>
            <td>–û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</td>
            <td><span class="improvement positive">‚úÖ –í–´–ü–û–õ–ù–ï–ù–û</span></td>
            <td>SAGA + Outbox + Reconciliation</td>
        </tr>
        <tr>
            <td>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SAGA pattern</td>
            <td><span class="improvement positive">‚úÖ –í–´–ü–û–õ–ù–ï–ù–û</span></td>
            <td>Event-driven —Å RabbitMQ</td>
        </tr>
        <tr>
            <td>–í–Ω–µ–¥—Ä–∏—Ç—å —Å–µ—Ä–≤–∏—Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td>
            <td><span class="improvement positive">‚úÖ –í–´–ü–û–õ–ù–ï–ù–û</span></td>
            <td>REST API —Å –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é</td>
        </tr>
        <tr>
            <td>–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏</td>
            <td><span class="improvement positive">‚úÖ –í–´–ü–û–õ–ù–ï–ù–û</span></td>
            <td>Retry –ª–æ–≥–∏–∫–∞, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</td>
        </tr>
        <tr>
            <td>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–µ—à–µ–π</td>
            <td><span class="improvement positive">‚úÖ –í–´–ü–û–õ–ù–ï–ù–û</span></td>
            <td>Redis –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏ –¥–∏–∞–ª–æ–≥–æ–≤</td>
        </tr>
    </table>

</body>
</html>
