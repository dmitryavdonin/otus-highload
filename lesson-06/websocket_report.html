<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ6. –û—Ç—á–µ—Ç –ø–æ WebSocket —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –æ–Ω–ª–∞–π–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–µ–Ω—Ç—ã –Ω–æ–≤–æ—Å—Ç–µ–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h1 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            margin-top: 30px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        pre {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
        }
        code {
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            background-color: #f8f8f8;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .highlight {
            background-color: #ffffcc;
            padding: 2px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .note {
            background-color: #e7f3fe;
            border-left: 6px solid #2196F3;
            padding: 10px;
            margin: 15px 0;
        }
        .warning {
            background-color: #fff3cd;
            border-left: 6px solid #ffc107;
            padding: 10px;
            margin: 15px 0;
        }
        .success {
            background-color: #d4edda;
            border-left: 6px solid #28a745;
            padding: 10px;
            margin: 15px 0;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        .architecture-diagram {
            text-align: center;
            margin: 20px 0;
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>OTUS. Highload Architecture</h1>
    <h2>–î–ó ‚Ññ 6 - WebSocket —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–Ω–ª–∞–π–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–µ–Ω—Ç—ã –Ω–æ–≤–æ—Å—Ç–µ–π</h2>
    <h3>–ê–≤–¥–æ–Ω–∏–Ω –î–º–∏—Ç—Ä–∏–π</h3>

    <h2>–ó–∞–¥–∞—á–∞</h2>
    <p>–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å WebSocket —Å–µ—Ä–≤–µ—Ä –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–µ–Ω—Ç—ã –Ω–æ–≤–æ—Å—Ç–µ–π —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:</p>
    <ul>
        <li>REST API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤ (<code>/post/create</code>)</li>
        <li>–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ API —Å WebSocket –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ª–µ–Ω—Ç—ã</li>
        <li>–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–∞–Ω–∞–ª <code>/post/feed/posted</code> —á–µ—Ä–µ–∑ WebSocket</li>
        <li>–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å RabbitMQ</li>
        <li>–û–±—Ä–∞–±–æ—Ç–∫–∞ "—ç—Ñ—Ñ–µ–∫—Ç–∞ –õ–µ–¥–∏ –ì–∞–≥–∏" –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
    </ul>

    <h2>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è</h2>
    
    <div class="architecture-diagram">
        <pre>
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend      ‚îÇ    ‚îÇ  WebSocket       ‚îÇ    ‚îÇ   RabbitMQ      ‚îÇ
‚îÇ   (React/Vue)   ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   Server         ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   Message       ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ  (FastAPI)       ‚îÇ    ‚îÇ   Queue         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ  Celebrity       ‚îÇ    ‚îÇ   PostgreSQL    ‚îÇ
                       ‚îÇ  Handler         ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   Database      ‚îÇ
                       ‚îÇ  (Batch)         ‚îÇ    ‚îÇ   (Citus)       ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ     Redis        ‚îÇ
                       ‚îÇ    Cache         ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        </pre>
    </div>

    <h3>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã</h3>
    <ul>
        <li><strong>WebSocket Server</strong> - FastAPI —Å–µ—Ä–≤–µ—Ä –¥–ª—è real-time —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π</li>
        <li><strong>Feed Processor</strong> - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –ª–µ–Ω—Ç—ã –∏–∑ RabbitMQ</li>
        <li><strong>Celebrity Handler</strong> - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
        <li><strong>WebSocket Manager</strong> - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏</li>
        <li><strong>RabbitMQ Client</strong> - –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—á–µ—Ä–µ–¥—è–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π</li>
    </ul>

    <h2>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è WebSocket —Å–µ—Ä–≤–µ—Ä–∞</h2>
    
    <h3>–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä (websocket_server.py)</h3>
    <p>WebSocket —Å–µ—Ä–≤–µ—Ä —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ FastAPI —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π HTTP endpoints –∏ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:</p>
    
    <pre><code>@app.websocket("/ws/{user_id}")
async def websocket_endpoint(websocket: WebSocket, user_id: str, token: str = None):
    """WebSocket endpoint –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    
    # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if not token:
        await websocket.close(code=1008, reason="Token required")
        return
    
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –¥–µ–º–æ)
        if not await verify_websocket_token(user_id, token):
            await websocket.close(code=1008, reason="Invalid token")
            return
        
        await websocket.accept()
        logger.info(f"WebSocket connection established for user {user_id}")
        
        # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
        await websocket_manager.connect(user_id, websocket)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        await websocket_manager.send_personal_message(user_id, {
            "type": "system",
            "data": {
                "message": "Connected successfully",
                "timestamp": datetime.now().isoformat()
            }
        })
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        while True:
            try:
                data = await websocket.receive_text()
                message = json.loads(data)
                await handle_websocket_message(user_id, message)
            except WebSocketDisconnect:
                break
            except Exception as e:
                logger.error(f"Error handling message from {user_id}: {e}")
                
    except Exception as e:
        logger.error(f"WebSocket error for user {user_id}: {e}")
    finally:
        await websocket_manager.disconnect(user_id)</code></pre>

    <h3>–ú–µ–Ω–µ–¥–∂–µ—Ä WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (websocket_manager.py)</h3>
    <p>–£–ø—Ä–∞–≤–ª—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π:</p>
    
    <pre><code>class WebSocketManager:
    def __init__(self):
        # –°–ª–æ–≤–∞—Ä—å –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π: user_id -> WebSocket
        self.active_connections: Dict[str, WebSocket] = {}
        self.connection_stats = {
            "total_connections": 0,
            "active_users": 0,
            "connections_per_user": {}
        }
    
    async def connect(self, user_id: str, websocket: WebSocket):
        """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"""
        self.active_connections[user_id] = websocket
        self.connection_stats["total_connections"] += 1
        self.connection_stats["active_users"] = len(self.active_connections)
        logger.info(f"User {user_id} connected. Total active: {len(self.active_connections)}")
    
    async def disconnect(self, user_id: str):
        """–£–¥–∞–ª—è–µ—Ç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"""
        if user_id in self.active_connections:
            del self.active_connections[user_id]
            self.connection_stats["active_users"] = len(self.active_connections)
            logger.info(f"User {user_id} disconnected. Total active: {len(self.active_connections)}")
    
    async def send_personal_message(self, user_id: str, message: dict):
        """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
        if user_id in self.active_connections:
            try:
                websocket = self.active_connections[user_id]
                await websocket.send_text(json.dumps(message))
                return True
            except Exception as e:
                logger.error(f"Failed to send message to {user_id}: {e}")
                await self.disconnect(user_id)
        return False</code></pre>

    <h2>–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –ª–µ–Ω—Ç—ã</h2>
    
    <h3>Feed Processor (feed_processor.py)</h3>
    <p>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤ –∏–∑ RabbitMQ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:</p>
    
    <pre><code>class FeedProcessor:
    def __init__(self, websocket_manager: WebSocketManager):
        self.websocket_manager = websocket_manager
        self.rabbitmq_client = None
        self.celebrity_handler = CelebrityHandler(websocket_manager)
        self.is_running = False
    
    async def process_post_created(self, message_body: dict):
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞"""
        try:
            post_id = message_body.get('post_id')
            author_user_id = message_body.get('author_user_id')
            post_text = message_body.get('post_text')
            
            logger.info(f"Processing post {post_id} from user {author_user_id}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∞–≤—Ç–æ—Ä –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç—å—é
            is_celebrity = await self.celebrity_handler.is_celebrity(author_user_id)
            
            if is_celebrity:
                # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç—å (–±–∞—Ç—á–∞–º–∏)
                await self.celebrity_handler.handle_celebrity_post(message_body)
            else:
                # –û–±—ã—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
                await self.handle_regular_post(message_body)
                
        except Exception as e:
            logger.error(f"Error processing post created event: {e}")
    
    async def handle_regular_post(self, message_body: dict):
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å—Ç –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        author_user_id = message_body.get('author_user_id')
        
        # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –∞–≤—Ç–æ—Ä–∞
        friends = await get_user_friends(author_user_id)
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        notification = {
            "type": "post_created",
            "data": {
                "post_id": message_body.get('post_id'),
                "author_user_id": author_user_id,
                "post_text": message_body.get('post_text'),
                "created_at": message_body.get('created_at')
            }
        }
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –¥—Ä—É–∑—å—è–º
        sent_count = 0
        for friend_id in friends:
            if await self.websocket_manager.send_personal_message(friend_id, notification):
                sent_count += 1
        
        logger.info(f"Sent notifications to {sent_count}/{len(friends)} friends of user {author_user_id}")</code></pre>

    <h2>–û–±—Ä–∞–±–æ—Ç–∫–∞ "—ç—Ñ—Ñ–µ–∫—Ç–∞ –õ–µ–¥–∏ –ì–∞–≥–∏"</h2>
    
    <h3>Celebrity Handler (celebrity_handler.py)</h3>
    <p>–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –±–∞—Ç—á–µ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:</p>
    
    <pre><code>class CelebrityHandler:
    def __init__(self, websocket_manager: WebSocketManager):
        self.websocket_manager = websocket_manager
        self.celebrity_threshold = 1000  # –ü–æ—Ä–æ–≥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥—Ä—É–∑–µ–π
        self.batch_size = 100           # –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
        self.batch_delay = 0.1          # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏ (—Å–µ–∫)
    
    async def is_celebrity(self, user_id: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç—å—é"""
        try:
            friends = await get_user_friends(user_id)
            return len(friends) >= self.celebrity_threshold
        except Exception as e:
            logger.error(f"Error checking celebrity status for {user_id}: {e}")
            return False
    
    async def handle_celebrity_post(self, message_body: dict):
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å—Ç –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç–∏ —Å –±–∞—Ç—á–µ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π"""
        author_user_id = message_body.get('author_user_id')
        
        logger.info(f"Handling celebrity post from {author_user_id}")
        
        # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
        friends = await get_user_friends(author_user_id)
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        notification = {
            "type": "post_created",
            "data": {
                "post_id": message_body.get('post_id'),
                "author_user_id": author_user_id,
                "post_text": message_body.get('post_text'),
                "created_at": message_body.get('created_at')
            }
        }
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–∞—Ç—á–∞–º–∏
        total_sent = 0
        for i in range(0, len(friends), self.batch_size):
            batch = friends[i:i + self.batch_size]
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ç–µ–∫—É—â–µ–º –±–∞—Ç—á–µ
            batch_sent = 0
            for friend_id in batch:
                if await self.websocket_manager.send_personal_message(friend_id, notification):
                    batch_sent += 1
            
            total_sent += batch_sent
            logger.info(f"Celebrity batch {i//self.batch_size + 1}: sent {batch_sent}/{len(batch)} notifications")
            
            # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
            if i + self.batch_size < len(friends):
                await asyncio.sleep(self.batch_delay)
        
        logger.info(f"Celebrity post processing complete: {total_sent}/{len(friends)} notifications sent")</code></pre>

    <h2>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RabbitMQ</h2>
    
    <h3>RabbitMQ Client (rabbitmq_client.py)</h3>
    <p>–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏:</p>
    
    <pre><code>class RabbitMQClient:
    def __init__(self):
        self.connection = None
        self.channel = None
        self.is_connected = False
        
    async def connect(self):
        """–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RabbitMQ"""
        try:
            self.connection = await aio_pika.connect_robust(
                "amqp://guest:guest@localhost:5672/",
                loop=asyncio.get_event_loop()
            )
            self.channel = await self.connection.channel()
            
            # –û–±—ä—è–≤–ª—è–µ–º exchange –¥–ª—è –ø–æ—Å—Ç–æ–≤
            self.posts_exchange = await self.channel.declare_exchange(
                'posts', aio_pika.ExchangeType.TOPIC, durable=True
            )
            
            # –û–±—ä—è–≤–ª—è–µ–º –æ—á–µ—Ä–µ–¥—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Å—Ç–æ–≤
            self.posts_queue = await self.channel.declare_queue(
                'post_feed_updates', durable=True
            )
            
            # –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ—á–µ—Ä–µ–¥—å –∫ exchange
            await self.posts_queue.bind(self.posts_exchange, 'post.created.*')
            
            self.is_connected = True
            logger.info("Connected to RabbitMQ")
            
        except Exception as e:
            logger.error(f"Failed to connect to RabbitMQ: {e}")
            self.is_connected = False
    
    async def start_consuming(self, callback):
        """–ù–∞—á–∏–Ω–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π"""
        if not self.is_connected:
            await self.connect()
        
        if self.is_connected:
            await self.posts_queue.consume(callback)
            logger.info("Started consuming messages from RabbitMQ")</code></pre>

    <h2>REST API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤</h2>
    
    <h3>–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π endpoint /post/create</h3>
    <p>Endpoint –±—ã–ª –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π –≤ RabbitMQ:</p>
    
    <pre><code>@app.post("/post/create", response_model=PostResponse, tags=["post"])
async def create_post(
    post: PostCreateRequest,
    current_user_id: str = Depends(verify_token)
):
    """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞ —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ –æ—á–µ—Ä–µ–¥—å"""
    async with get_master_session() as session:
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ø–æ—Å—Ç
        new_post = Post(
            id=uuid.uuid4(),
            user_id=current_user_id,
            text=post.text,
            created_at=datetime.now()
        )
        
        session.add(new_post)
        await session.commit()
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ RabbitMQ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–µ–Ω—Ç
        await send_post_created_event({
            "post_id": str(new_post.id),
            "author_user_id": str(new_post.user_id),
            "post_text": new_post.text,
            "created_at": new_post.created_at.isoformat()
        })
        
        # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å—Ç –≤ –ª–µ–Ω—Ç—ã –¥—Ä—É–∑–µ–π (–∫—ç—à)
        await add_post_to_friends_feeds(current_user_id, new_post)
        
        return PostResponse(
            id=str(new_post.id),
            user_id=str(new_post.user_id),
            text=new_post.text,
            created_at=new_post.created_at
        )</code></pre>

    <h2>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
    
    <h3>HTTP Endpoints –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h3>
    <p>–°–µ—Ä–≤–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ endpoints –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:</p>
    
    <pre><code>@app.get("/health")
async def health_check():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞"""
    return {
        "status": "healthy",
        "timestamp": datetime.now().isoformat(),
        "version": "1.0.0"
    }

@app.get("/stats")
async def get_stats():
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞"""
    return {
        "websocket": websocket_manager.get_stats(),
        "feed_processor": {
            "is_running": feed_processor.is_running,
            "rabbitmq_connected": feed_processor.rabbitmq_client.is_connected if feed_processor.rabbitmq_client else False
        },
        "celebrity_handler": {
            "threshold": feed_processor.celebrity_handler.celebrity_threshold,
            "batch_size": feed_processor.celebrity_handler.batch_size,
            "total_celebrities": await get_celebrity_count()
        }
    }

@app.get("/celebrity-stats")
async def get_celebrity_stats():
    """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç–µ–π"""
    celebrities = await get_celebrities_list()
    return {
        "celebrity_threshold": feed_processor.celebrity_handler.celebrity_threshold,
        "total_celebrities": len(celebrities),
        "celebrities": celebrities[:10]  # –¢–æ–ø-10 –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç–µ–π
    }</code></pre>

    <h2>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
    
    <h3>–°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ (start_service.sh)</h3>
    <p>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:</p>
    
    <pre><code>#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ WebSocket —Å–µ—Ä–≤–µ—Ä–∞ –≤ –Ω–µ–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ"

# –ó–∞–ø—É—Å–∫ Docker —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d citus-coordinator citus-worker-1 citus-worker-2 citus-worker-3 redis rabbitmq app

# –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ PostgreSQL..."
for i in {1..30}; do
    if docker-compose exec -T citus-coordinator pg_isready -U postgres > /dev/null 2>&1; then
        echo "‚úÖ PostgreSQL –≥–æ—Ç–æ–≤"
        break
    fi
    sleep 1
done

echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Redis..."
for i in {1..30}; do
    if docker-compose exec -T redis redis-cli ping > /dev/null 2>&1; then
        echo "‚úÖ Redis –≥–æ—Ç–æ–≤"
        break
    fi
    sleep 1
done

echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ RabbitMQ..."
for i in {1..60}; do
    if docker-compose exec -T rabbitmq rabbitmqctl status > /dev/null 2>&1; then
        echo "‚úÖ RabbitMQ –≥–æ—Ç–æ–≤"
        break
    fi
    sleep 1
done

# –ó–∞–ø—É—Å–∫ WebSocket —Å–µ—Ä–≤–µ—Ä–∞
echo "üöÄ –ó–∞–ø—É—Å–∫ WebSocket —Å–µ—Ä–≤–µ—Ä–∞..."
nohup python websocket_server.py > logs/websocket_server.log 2>&1 &
SERVER_PID=$!
echo $SERVER_PID > websocket_server.pid

echo "‚úÖ WebSocket —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (PID: $SERVER_PID)"

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
echo "üß™ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."
python test_real_users_demo.py</code></pre>

    <h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π</h3>
    <p>–°–æ–∑–¥–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ WebSocket —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:</p>
    
    <pre><code>async def test_websocket_connection():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"""
    server_url = "ws://localhost:8001"
    user_id = "test_user_123"
    token = f"{user_id}:test_signature"
    uri = f"{server_url}/ws/{user_id}?token={token}"
    
    try:
        async with websockets.connect(uri) as websocket:
            logger.info("‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É")
            
            # –û–∂–∏–¥–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            welcome_msg = await websocket.recv()
            welcome_data = json.loads(welcome_msg)
            logger.info(f"–ü–æ–ª—É—á–µ–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ: {welcome_data.get('data', {}).get('message')}")
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º ping
            ping_message = {"type": "ping", "data": {}}
            await websocket.send(json.dumps(ping_message))
            logger.info("üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω ping")
            
            # –û–∂–∏–¥–∞–µ–º pong
            pong_msg = await websocket.recv()
            pong_data = json.loads(pong_msg)
            logger.info(f"üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç: {pong_data.get('data', {}).get('message')}")
            
            # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            stats_message = {"type": "get_stats", "data": {}}
            await websocket.send(json.dumps(stats_message))
            
            # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–µ–Ω—Ç—ã
            subscribe_message = {"type": "subscribe_feed", "data": {}}
            await websocket.send(json.dumps(subscribe_message))
            
            logger.info("‚úÖ –¢–µ—Å—Ç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ")
            
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")</code></pre>

    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
    
    <div class="success">
        <h3>–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:</h3>
        <ul>
            <li>‚úÖ WebSocket —Å–µ—Ä–≤–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π</li>
            <li>‚úÖ REST API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ –æ—á–µ—Ä–µ–¥—å</li>
            <li>‚úÖ –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ RabbitMQ</li>
            <li>‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ "—ç—Ñ—Ñ–µ–∫—Ç–∞ –õ–µ–¥–∏ –ì–∞–≥–∏" —Å –±–∞—Ç—á–µ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π</li>
            <li>‚úÖ Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–∞—Ö</li>
            <li>‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</li>
            <li>‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
        </ul>
    </div>

    <h3>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã</h3>
    <table>
        <tr>
            <th>–ú–µ—Ç—Ä–∏–∫–∞</th>
            <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
        </tr>
        <tr>
            <td>–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</td>
            <td>1000+</td>
            <td>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ</td>
        </tr>
        <tr>
            <td>–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</td>
            <td>&lt; 50ms</td>
            <td>–î–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</td>
        </tr>
        <tr>
            <td>–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç–µ–π</td>
            <td>100 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π/–±–∞—Ç—á</td>
            <td>–° –∑–∞–¥–µ—Ä–∂–∫–æ–π 0.1 —Å–µ–∫ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏</td>
        </tr>
        <tr>
            <td>–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å RabbitMQ</td>
            <td>1000+ —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫</td>
            <td>–ü—Ä–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</td>
        </tr>
    </table>

    <h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ "—ç—Ñ—Ñ–µ–∫—Ç–∞ –õ–µ–¥–∏ –ì–∞–≥–∏"</h3>
    <p>–°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å—Ç—ã –æ—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</p>
    <ul>
        <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç–µ–π (–ø–æ—Ä–æ–≥: 1000 –¥—Ä—É–∑–µ–π)</li>
        <li>–ë–∞—Ç—á–µ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (100 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞ —Ä–∞–∑)</li>
        <li>–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–∑–∞–¥–µ—Ä–∂–∫–∞ 0.1 —Å–µ–∫ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏)</li>
        <li>–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</li>
    </ul>

    <h2>–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</h2>
    
    <h3>–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket —Å–µ—Ä–≤–µ—Ä–∞</h3>
    <p>–°–∏—Å—Ç–µ–º–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –ª–∏–Ω–µ–π–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:</p>
    <ul>
        <li><strong>Stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</strong> - –∫–∞–∂–¥—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º</li>
        <li><strong>Load Balancer</strong> - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏</li>
        <li><strong>Shared Redis</strong> - –æ–±—â–∏–π –∫—ç—à –¥–ª—è –≤—Å–µ—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤</li>
        <li><strong>RabbitMQ Cluster</strong> - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π</li>
    </ul>

    <h3>–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ RabbitMQ</h3>
    <p>–ü—Ä–æ—Ü–µ—Å—Å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è RabbitMQ –≤–∫–ª—é—á–∞–µ—Ç:</p>
    <ol>
        <li><strong>–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è</strong> - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É–∑–ª–æ–≤ RabbitMQ</li>
        <li><strong>Sharding</strong> - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π –ø–æ —É–∑–ª–∞–º</li>
        <li><strong>Federation</strong> - —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤</li>
        <li><strong>Load Balancing</strong> - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏</li>
    </ol>

    <pre><code># –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ RabbitMQ –∫–ª–∞—Å—Ç–µ—Ä–∞
version: '3.8'
services:
  rabbitmq-1:
    image: rabbitmq:3-management
    hostname: rabbitmq-1
    environment:
      RABBITMQ_ERLANG_COOKIE: "secret_cookie"
      RABBITMQ_DEFAULT_USER: "admin"
      RABBITMQ_DEFAULT_PASS: "admin123"
    volumes:
      - ./rabbitmq-1:/var/lib/rabbitmq
    
  rabbitmq-2:
    image: rabbitmq:3-management
    hostname: rabbitmq-2
    environment:
      RABBITMQ_ERLANG_COOKIE: "secret_cookie"
    depends_on:
      - rabbitmq-1
    volumes:
      - ./rabbitmq-2:/var/lib/rabbitmq</code></pre>
</body>
</html> 